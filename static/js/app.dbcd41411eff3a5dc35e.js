webpackJsonp([5],{NHnr:function(t,n,o){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var e=o("xd7I"),a=o("3cXf"),i=o.n(a),r=o("mt/N"),s=[{title:"餐饮",fill:"#f2dc66",stroke:"#cebd63"},{title:"服装",fill:"#fece8b",stroke:"#e0b170"},{title:"百货",fill:"#eacf98",stroke:"#d9b87a"},{title:"娱乐",fill:"#87A765",stroke:"#7eb543"},{title:"美容美发",fill:"#e89bb6",stroke:"#ce7795"},{title:"电子数码",fill:"#94cefd",stroke:"#8abbe3"}],l=o("Muz9"),c=o.n(l),u=Object({NODE_ENV:"production"}).BASE_URL,d=c.a.create({baseURL:u,timeout:1e4}),h={},p=function(t){var n=h.point;if(n){var o=t.clientX-h.x,e=t.clientY-h.y;0===o&&0===e||(n.isMoving=!0,n.x+=o,n.y+=e,h.x=t.clientX,h.y=t.clientY)}},f=function t(){document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",t)},g={components:{importer:function(t){return o.e(2).then(function(){var n=[o("bbWi")];t.apply(null,n)}.bind(this)).catch(o.oe)},typemarks:function(t){return o.e(3).then(function(){var n=[o("hEaw")];t.apply(null,n)}.bind(this)).catch(o.oe)},mapediter:function(t){return o.e(1).then(function(){var n=[o("365L")];t.apply(null,n)}.bind(this)).catch(o.oe)},roadsediter:function(t){return o.e(0).then(function(){var n=[o("h5XV")];t.apply(null,n)}.bind(this)).catch(o.oe)}},data:function(){return{winHeight:null,mainDom:null,mapDataDownloadDom:null,pathDataDownloadDom:null,roadsBackup:null,polygonsBackup:null,polygons:[],roads:[],currentPolygon:{},mode:"编辑地图",roadsCurrentShow:void 0}},watch:{mode:function(){this.resetSvg()},polygons:{handler:function(t){var n=this;if(r.e("editing-polygons",t),this.mapDataDownloadDom){var o=this.polygons.map(function(t,o){return 0===o?"["+i()(t)+",":o===n.polygons.length-1?i()(t)+"]":i()(t)+","}),e=new Blob(o,{type:"application/json"});this.mapDataDownloadDom.href=window.URL.createObjectURL(e)}},deep:!0}},computed:{currentPath:function(){if(Array.isArray(this.roads)&&null!==this.$root.currentEditingPathIndex)return this.roads[this.$root.currentEditingPathIndex]}},methods:{useTest:function(){var t=this;d.get("static/map.json").then(function(n){t.importMap(n.data)}),d.get("static/path.json").then(function(n){t.importPath(n.data)})},startPoint:function(t,n){h={x:t.clientX,y:t.clientY,point:n,pointCache:r.a(n)},document.addEventListener("mousemove",p),document.addEventListener("mouseup",f)},clickPoint:function(t,n){if(t.isMoving){var o=h.point,e=h.pointCache;e&&e.connect&&this.roads.forEach(function(t){t.forEach(function(t){t.connect&&t.x===e.x&&t.y===e.y&&(t.x=o.x,t.y=o.y)})}),h={},delete t.isMoving}else if(this.$root.cachePointMode){this.currentPolygon.connectPoint=t,t.connectBuildings||(t.connectBuildings=[]),t.connectBuildings.indexOf(this.currentPolygon.attrTitle)<0&&t.connectBuildings.push(this.currentPolygon.attrTitle),this.$root.cachePointMode=!1,this.savePath()}else{null===this.$root.currentEditingPathIndex&&(this.$root.currentEditingPathIndex=n);var a=this.currentPath&&r.c(t,this.currentPath);t.active?this.roadsCurrentShow=void 0:null!==a?this.roadsCurrentShow=t:(this.roads[this.$root.currentEditingPathIndex].push(t),t.connect=!0)}},breakConnect:function(){var t=this.currentPolygon.connectPoint.connectBuildings.indexOf(this.currentPolygon.attrTitle);t>=0&&this.currentPolygon.connectPoint.connectBuildings.splice(t,1),delete this.currentPolygon.connectPoint},drawPath:function(t){h&&h.point?h={}:(null===this.$root.currentEditingPathIndex&&(this.roads.push([]),this.$root.currentEditingPathIndex=this.roads.length-1),this.roads[this.$root.currentEditingPathIndex].push({x:t.offsetX,y:t.offsetY}))},savePath:function(){var t=this;if(r.e("editing-roads",this.roads),this.pathDataDownloadDom){var n=this.roads.map(function(n,o){return 0===o?"["+i()(n)+",":o===t.roads.length-1?i()(n)+"]":i()(n)+","}),o=new Blob(n,{type:"application/json"});this.pathDataDownloadDom.href=window.URL.createObjectURL(o)}},updatePath:function(){var t=this;this.$nextTick(function(){t.$forceUpdate()})},unchoosePath:function(){this.$root.currentEditingPathIndex=null},resetData:function(){this.resetSvg(),this.unchoosePath(),Array.isArray(this.polygonsBackup)&&(this.polygons=r.a(this.polygonsBackup)),Array.isArray(this.roadsBackup)&&(this.roads=r.a(this.roadsBackup))},clearData:function(){this.reset(),this.resetSvg(),this.unchoosePath(),this.polygonsBackup=null,this.roadsBackup=null,this.polygons=[],this.roads=[]},resetSvg:function(){(this.currentPolygon={},this.mainDom)&&this.mainDom.querySelectorAll("polygon.active").forEach(function(t){t.classList.remove("active")})},clickElement:function(t,n){this.resetSvg(),t.target.classList.add("active"),this.currentPolygon=n},reset:function(){this.currentPolygon={},this.$root.currentEditingPathIndex=null,this.mode="编辑地图",this.roadsCurrentShow=void 0},importSvg:function(t){this.polygonsBackup=t,this.polygons=r.a(this.polygonsBackup)},importMap:function(t){this.reset(),t.forEach(function(t){t.connectPoint||(t.connectPoint={})}),this.polygonsBackup=t,this.polygons=r.a(this.polygonsBackup),r.e("editing-polygons",t)},importPath:function(t){this.reset(),this.roadsBackup=t,this.roads=r.a(this.roadsBackup),r.e("editing-roads",this.roads)}},created:function(){var t=this,n=r.e("editing-polygons");n&&(this.polygonsBackup=n,this.polygons=r.a(this.polygonsBackup));var o=r.e("editing-roads");o&&(this.roadsBackup=o,this.roads=r.a(this.roadsBackup),this.$nextTick(function(){t.savePath()})),this.$root.buildingTypes=s},mounted:function(){this.mainDom=document.getElementById("svgElements"),this.mapDataDownloadDom=document.getElementById("mapDataDownload"),this.pathDataDownloadDom=document.getElementById("pathDataDownload")}},m={render:function(){var t=this,n=t.$createElement,o=t._self._c||n;return o("div",{staticClass:"flex-row",staticStyle:{overflow:"auto"},attrs:{id:"app"}},[o("div",{staticClass:"pr area-wrap oh"},[o("div",{staticClass:"layer",attrs:{id:"svgElements"}},[o("svg",{attrs:{width:"1000",height:"1000",xmlns:"http://www.w3.org/2000/svg"},on:{click:function(n){return n.target!==n.currentTarget?null:t.resetSvg(n)}}},[t._l(t.polygons,function(n,e){return[o("polygon",{key:"polygon"+e,class:{isBlock:n.block,svgArea:!0},style:n.type,attrs:{points:n.points,"data-x":n.attrDataX,"data-y":n.attrDataY,title:n.attrTitle},on:{click:function(o){return t.clickElement(o,n)}}})]})],2)]),t._v(" "),o("div",{staticClass:"layer mapFloat"},[t._l(t.polygons,function(n,e){return n.block?t._e():[o("span",{key:"float"+e,staticClass:"_title",style:{left:n.attrDataX+"px",top:n.attrDataY+"px"}},[t._v(t._s(n.attrTitle))])]})],2),t._v(" "),"路径绘制"===t.mode||t.$root.cachePointMode?o("div",{staticClass:"layer svgPath"},[o("div",{staticClass:"layer drawPath",on:{click:t.drawPath}},t._l(t.roads,function(n,e){return o("div",{key:"showPath"+e},t._l(n,function(n,a){return o("div",{key:"showPathPoint"+a,staticClass:"drawPoint",class:{active:!!n.active},style:{left:n.x+"px",top:n.y+"px"},attrs:{title:"路径"+(e+1)+" "+n.x+","+n.y},on:{click:function(o){return o.stopPropagation(),t.clickPoint(n,e)},mousedown:function(o){return t.startPoint(o,n)}}})}),0)}),0),t._v(" "),o("svg",{attrs:{width:"1000",height:"1000",xmlns:"http://www.w3.org/2000/svg"}},t._l(t.roads,function(n,e){return o("polyline",{key:"showPath"+e,class:{editingPath:!0,active:e===t.$root.currentEditingPathIndex},attrs:{points:n.map(function(t){return t.x+","+t.y}).join(" ")}})}),0)]):t._e(),t._v(" "),o("typemarks")],1),t._v(" "),o("div",{staticClass:"flex-1",staticStyle:{margin:"20px"}},[o("importer",{on:{importSvg:t.importSvg,importMap:t.importMap,importPath:t.importPath}}),t._v(" "),o("el-row",{attrs:{gutter:8}},[o("el-col",{attrs:{span:8}},[o("el-radio-group",{attrs:{size:"small"},model:{value:t.mode,callback:function(n){t.mode=n},expression:"mode"}},[o("el-radio-button",{attrs:{label:"编辑地图"}}),t._v(" "),o("el-radio-button",{attrs:{label:"路径绘制"}})],1),t._v(" "),o("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"warning",size:"small"},on:{click:t.useTest}},[t._v("体验数据")])],1),t._v(" "),o("el-col",{staticClass:"group-bar-right",attrs:{span:16}},[o("el-button",{attrs:{icon:"el-icon-download",size:"small"}},[o("a",{attrs:{id:"mapDataDownload",download:"map.json",target:"_blank"}},[t._v("保存map.json")])]),t._v(" "),o("el-button",{attrs:{icon:"el-icon-download",size:"small",disabled:!t.roads.length}},[o("a",{attrs:{id:"pathDataDownload",download:"path.json",target:"_blank"}},[t._v("保存path.json")])]),t._v(" "),o("el-button",{attrs:{type:"danger",icon:"el-icon-warning",size:"small",disabled:!t.polygonsBackup||!t.roadsBackup},on:{click:t.resetData}},[t._v("恢复数据")]),t._v(" "),o("el-button",{attrs:{type:"danger",icon:"el-icon-warning",size:"small"},on:{click:t.clearData}},[t._v("清空数据")])],1)],1),t._v(" "),o("mapediter",{directives:[{name:"show",rawName:"v-show",value:"编辑地图"===t.mode,expression:"mode==='编辑地图'"}],attrs:{polygon:t.currentPolygon}}),t._v(" "),o("roadsediter",{directives:[{name:"show",rawName:"v-show",value:"路径绘制"===t.mode&&!t.$root.cachePointMode,expression:"mode==='路径绘制' && !$root.cachePointMode"}],attrs:{roads:t.roads,roadsCurrentShow:t.roadsCurrentShow},on:{savePath:t.savePath,update:t.updatePath}})],1)])},staticRenderFns:[]};var v=o("C7Lr")(g,m,!1,function(t){o("mYCz")},null,null).exports,y=o("NxjZ"),P=o.n(y);o("zlkP");e.default.use(P.a),e.default.config.productionTip=!1,new e.default({data:function(){return{cachePointMode:!1,buildingTypes:[],currentEditingPathIndex:null}},render:function(t){return t(v)}}).$mount("#app")},mYCz:function(t,n){},"mt/N":function(t,n,o){"use strict";o.d(n,"d",function(){return l}),o.d(n,"a",function(){return c}),o.d(n,"e",function(){return u}),o.d(n,"b",function(){return d}),o.d(n,"c",function(){return h});var e=o("3cXf"),a=o.n(e),i=o("hRKE"),r=o.n(i),s=o("xd7I"),l=function(t,n){var o=new FileReader;o.readAsText(t),o.onload=function(){"function"==typeof n&&n(this.result)}},c=function t(n){if(!n)return n;var o=n instanceof Array?[]:{};for(var e in n)o[e]="object"===r()(n[e])?t(n[e]):n[e];return o},u=function(t,n){if(void 0===n){var o=sessionStorage.getItem(t);return o&&0===o.indexOf("autostringify-")?JSON.parse(o.split("autostringify-")[1]):o}return("object"===(void 0===n?"undefined":r()(n))||Array.isArray(n))&&(n="autostringify-"+a()(n)),sessionStorage.setItem(t,n)},d=function(t,n){var o=[],e=t.match(/<polygon([^<]+)\/>/g);e.length||s.default.$notify({title:"警告",message:"svg文件异常",type:"warning"}),e.forEach(function(t){var n=/points="([^"]+)"/g.exec(t),e=/title="([^"]+)"/g.exec(t),a=/data-x="([^"]+)"/g.exec(t),i=/data-y="([^"]+)"/g.exec(t);if(null===n)return new Error('polygon without prop "points"');var r=(n=n[1].trim().split(" ").map(function(t){return t.trim().replace(/\\r\\n\\t/g,"")}).join(" ")).trim().split(" ").map(function(t){return t.trim().split(",").join(" ")});if(e=null===e?"未命名":e[1],null===a||null===i){var s,l,c,u,d=[],h=[];r.forEach(function(t){var n=t.split(" ");d.push(n[0]),h.push(n[1])}),s=Math.max.apply(null,d),l=Math.max.apply(null,h),c=Math.min.apply(null,d),u=Math.min.apply(null,h),r=r.map(function(t){return(t=t.split(" ").map(function(t){return t+"px"})).join(" ")}),a=parseInt((s+c)/2),i=parseInt((l+u)/2)}else a=a[1],i=i[1];o.push({points:n,attrDataX:a,attrDataY:i,attrTitle:e,connectPoint:{}})}),"function"==typeof n&&n(o)},h=function(t,n){for(var o=null,e=0;e<n.length;e++){var a=n[e];if(a.x===t.x&&a.y===t.y){o=e;break}}return o};new s.default},zlkP:function(t,n){}},["NHnr"]);